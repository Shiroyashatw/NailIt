<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商品頁面</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-router/dist/vue-router.js"></script>

    <style>

        .ColorsRadio,.TagRadio{
            display:none;
        }

        .DisplayCircle{
            width: 25px;
            height: 25px;
            border-radius: 50%;
        }

        .DisplayCircle:hover {
        border-radius: 0%;
             width: 25px;
             height: 25px;
             transition: 1s;
        cursor:pointer;
        }
        .TagLabel {
            border: solid gray 1px;
            border-radius: 10px;
            padding-top: 1px;
            padding-bottom: 1px;
            font-size: 13px;
        }

        .TagLabel:hover{
            background-color:gray;
            color:white;
        }

        /*range*/

        .RangeContainer {
            display: flex;
            flex-direction: column;
            /*width: 80%;*/
            margin: 10% auto;
        }

        .SliderControl {
            position: relative;
            /*min-height: 50px;*/
            height:20px;
        }

        .FromControl {
            position: relative;
            display: flex;
            justify-content: space-between;
            color: #635a5a;
            
        }

        input[type=range]::-webkit-slider-thumb{
            -webkit-appearance:none;
            pointer-events:all;
            border-radius:50%;
            cursor:pointer;
            background-color:#fff;
            box-shadow: 0 0 0 1px #C6C6C6;
            width:12px;
            height:12px;
        }

        input[type=range]::-webkit-slider-thumb:hover{
            background:#f7f7f7;
        }

        input[type=range]::-webkit-slider-thumb:active{
            box-shadow: inset 0 0 3px #387bbe, 0 0 9px #387bbe;
            -webkit-box-shadow: inset 0 0 3px #387bbe, 0 0 9px #387bbe;
        }

        input[type="number"]{
            color:#8a8383;
            border:none;
            width:60px;
        }

        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button{
            opacity:1;
        }

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            height:2px;
            width:100%;
            position:absolute;
            pointer-events:none;
            background-color:#C6C6C6;
        }

        #FromSlider {
            height: 0;
            z-index: 1;
        }
        /*range-end-*/

        .heart{
            font-size:13px;
            position:absolute;
            color:red;
            margin-top:-36px;
        }

        #Ctitle {
            margin-top:24px;
            font-size:20px;
        }

        #Sortdiv {
            margin-top: 24px;
        }

        .Coverdiv {
            display: flex;
            flex-wrap: wrap;
            margin-top: 16px;
            /*margin-left: 90px;*/
            margin-left: 25px;
        }

        .Cover {
            /*margin-right: 70px;*/
            margin-right: 30px;
            height: 180px;
            width: 180px;
            object-fit: cover;
            object-position: center;
        }

        .Searchbar {
            padding: 10px;
            font-size: 16px;
            border: 1px solid grey;
            float: left;
            width: 80%;
        }

        .Searchbtn {
            background-color: black;
            float: left;
            width: 10%;
            padding: 7px;
            color: white;
            font-size: 20px;
            border: 1px solid black;
            border-left: none;
            cursor: pointer;
        }

            .Searchbtn:hover {
                background: #D0CECE;
            }


    </style>
</head>

<body>

    <div class="container-fluid" id="app">
        <div class="row">
            <div class="col-1"></div>
            <!--Left bar-->
            <div class="col-2">
                <div>
                    <a>首頁</a>
                    <span>></span>
                    <a href="Fliter.html">美甲查詢</a>
                </div>
                <div class="mt-3">
                    <label>地區</label>
                    <div>
                        <div>
                            <select v-model="SelectedCity" onchange="ShowCountry(this)">
                                <option value="none" selected disabled hidden>請選擇縣市</option>
                                <option v-for="(item,key) in City" v-bind:value="[key]">{{City[key]}}</option>
                            </select>
                        </div>
                        <div class="mt-2">
                            <select v-model="SelectedArea" v-if="ShowAreas" onchange="ShowArea(this)">
                                <option value="none" selected disabled hidden>請選擇地區</option>
                                <option v-if="Area" v-for="(item,key) in Area" v-bind:value="Area[key]">{{item}}</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="mt-2">
                    <label>色彩</label>
                    <br />
                        <div v-for="(item,key) in Colors" class="d-inline-flex">
                            <label class="DisplayCircle mx-1"  v-bind:style="ColorStyle[key]" >
                                <input class="ColorsRadio" type="radio" v-bind:value="Colors[key].colorId" onclick="ShowColor(this)"/>
                            </label>
                        </div>
                </div>
                <div>
                    <label>標籤</label>
                    <div>
                        <label class="px-3  mx-1 TagLabel" v-for="(item,key) in Tag">
                            {{Tag[key].tagName}}
                            <input class="TagRadio" type="radio" v-bind:value="Tag[key].tagName" onclick="ShowTag(this)" />
                        </label>
                    </div>
                </div>
                <div>
                    <label>價格</label>
                    <div class="RangeContainer">
                        <div class="SliderControl">
                            <!--<input id="FromSlider" type="range" v-bind:value="MinPrice" v-bind:min="MinPrice" v-bind:max="MaxPrice" />-->
                            <input id="FromSlider" type="range" v-model="SearchMin" v-bind:min="MinPrice" v-bind:max="MaxPrice" />
                            <!--<input id="ToSlider" type="range" v-bind:value="MaxPrice" v-bind:min="MinPrice" v-bind:max="MaxPrice" />-->
                            <input id="ToSlider" type="range" v-model="SearchMax" v-bind:min="MinPrice" v-bind:max="MaxPrice" />
                        </div>
                        <div class="FromControl">
                            <div class="ControlContainer">
                                <div class="FromLabel">Min</div>
                                <!--<input id="Frommininput" class="Frominput" type="number" value="10" min="0" max="100" />-->
                                <!--<input id="Frommininput" class="Frominput" type="number" v-bind:value="MinPrice" v-bind:min="MinPrice" v-bind:max="MaxPrice"/>-->
                                <input id="Frommininput" class="Frominput" type="number" v-model="SearchMin" v-bind:min="MinPrice" v-bind:max="MaxPrice"/>
                            </div>
                            <div class="ControlContainer">
                                <div class="FromLabel">Max</div>
                                <!--<input id="Frommaxinput" class="FromMaxinput" type="number" value="40" min="0" max="100" />-->
                                <!--<input id="Frommaxinput" class="FromMaxinput" type="number" v-bind:value="MaxPrice" v-bind:min="MinPrice" v-bind:max="MaxPrice"/>-->
                                <input id="Frommaxinput" class="FromMaxinput" type="number" v-model="SearchMax" v-bind:min="MinPrice" v-bind:max="MaxPrice"/>
                            </div>
                        </div>
                    </div>
                    <!--<div>
                        <button onclick="SeachPrice()">範圍查詢</button>
                    </div>-->
                </div>
                <div class="mt-2">
                    <label>施作部位</label>
                    <div>
                        <label class="px-3  mx-1 TagLabel" v-for="(item,key) in CCode">
                            {{CCode[key].codeRepresent}}
                            <input class="TagRadio" type="radio"  v-bind:value="CCode[key].codeId" onclick="ShowPart(this)"/>
                        </label>
                    </div>
                </div>
            </div>
            <!--Left bar End-->
            <div class="col-1"></div>
            <!--Demo-->
            <div class="col-7 mt-3">
                <div class="d-flex justify-content-between">
                    <div id="Ctitle">
                        <b>美甲查詢</b>
                    </div>
                    <div id="Sortdiv">
                        <select v-model="Query" onchange="ChangeQuery(this)">
                            <option value="none" selected disabled hidden>請選擇</option>
                            <option value="QueryM">查詢工作室</option>
                            <option value="QueryNT">查詢名稱/標籤</option>
                        </select>
                        <div v-if="NowQuery=='QueryNT'">
                            <input class="Searchbar" type="text" placeholder="作品,標籤" v-model="SearchString">
                            <button class="Searchbtn" onclick="Searchit()"><i class="fa fa-search"></i></button>
                        </div>
                        <div v-if="NowQuery=='QueryM'">
                            <input class="Searchbar" type="text" placeholder="工作室" v-model="SearchM">
                            <button class="Searchbtn" onclick="SearchM()"><i class="fa fa-search"></i></button>
                        </div>
                    </div>
                </div>
                <div>共計商品數</div>
                <!--預設-->
                <div class="d-flex Coverdiv">
                    <div v-for="(item,key) in DemoSet">
                        <img class="Cover" v-bind:src="DemoSet[key].demoSetCover" />
                        <p>{{DemoSet[key].demoSetName}}</p>
                        <p>{{DemoSet[key].demoSetPrice}}</p>
                    </div>
                </div>
                <!--預設END-->
            </div>
            <!--Demo End-->
            <div class="col-1"></div>







        </div>
    </div>

    <!--vue-->
    <script>
        var app = new Vue({
            el: '#app',
            data: function () {
                return {
                    City: [],
                    AreaList:[],
                    Area:[],
                    SelectedCity: "none",
                    SelectedArea: "none",
                    Colors: [],
                    ColorStyle: [],
                    Tag: [],
                    ShowAreas: false,
                    CCode: [],
                    Displayheart: [],
                    DemoSet: [],
                    SelectedColor: "",
                    MaxPrice: 0,
                    MinPrice: 0,
                    SearchMin: this.MinPrice,
                    SearchMax: this.MaxPrice,
                    Query: "none",
                    NowQuery: false,
                    SearchString: "",
                    SearchM:"",
                    }
            },
            methods: {

                }

            })


    </script>

    <!--range-->
    <script>

        const fromSlider = document.querySelector('#FromSlider');
        const toSlider = document.querySelector('#ToSlider');
        const fromInput = document.querySelector('#Frommininput');
        const toInput = document.querySelector('#Frommaxinput');
        //const controlSlider = document.querySelector('.SliderControl');
        console.log(fromSlider);
        console.log(toSlider);
        //fillSlider(fromSlider, toSlider, '#C6C6C6', '#25daa5', toSlider);
        toSlider.style.backgroundColor = '#25daa5';
        setToggleAccessible(toSlider);
        //fromSlider.oninput = () => controlFromSlider(fromSlider, toSlider, fromInput);
        fromSlider.oninput = function () {
            controlFromSlider(fromSlider, toSlider, fromInput);
            GetPriceMin(fromSlider.value);
        };
        //toSlider.oninput = () => controlToSlider(fromSlider, toSlider, toInput);
        toSlider.oninput = function () {
            controlToSlider(fromSlider, toSlider, toInput);
            GetPriceMax(toSlider.value);
        };
        fromInput.oninput = function () {
            controlFromInput(fromSlider, fromInput, toInput, toSlider);
            GetPriceMin(fromSlider.value);

        };
        toInput.oninput = function () {
            controlToInput(toSlider, fromInput, toInput, toSlider);
            GetPriceMax(toSlider.value);

        };


        function fillSlider(from, to, sliderColor, rangeColor, controlSlider) {
            const rangeDistance = to.max - to.min;
            //console.log(rangeDistance);
            const fromPosition = from.value - to.min;
            const toPosition = to.value - to.min;
            controlSlider.style.background = `linear-gradient(
                to right,
                ${sliderColor} 0%,
                ${sliderColor} ${(fromPosition) / (rangeDistance) * 100}%,
                ${rangeColor} ${((fromPosition) / (rangeDistance)) * 100}%,
                ${rangeColor} ${(toPosition) / (rangeDistance) * 100}%,
                ${sliderColor} ${(toPosition) / (rangeDistance) * 100}%,
                ${sliderColor} 100%
            )`;
        }

        function controlFromInput(fromSlider,fromInput,toInput,controlSlider) {
            const [from, to] = getParsed(fromInput, toInput);
            fillSlider(fromInput, toInput, '#C6C6C6', '#25daa5', controlSlider);
            if (from > to) {
                fromSlider.value = to;
                fromInput.value = to;
            } else {
                fromSlider.value = from;
            }
        }

        function controlToInput(toSlider, fromInput , toInput, controlSlider) {
            const [from, to] = getParsed(fromInput, toInput);
            fillSlider(fromInput, toInput, '#C6C6C6', '#25daa5', controlSlider);
            setToggleAccessible(toInput);
            if (from <= to) {
                toSlider.value = to;
                toInput.value = to;
            } else {
                toInput.value = from;
            }
        }

        function controlFromSlider(fromSlider, toSlider, fromInput) {
            const [from, to] = getParsed(fromSlider, toSlider);
            fillSlider(fromSlider, toSlider, '#C6C6C6', '#25daa5', toSlider);
            if (from > to) {
                fromSlider.value = to;
                fromInput.value = to;
            } else {
                fromInput.value = from;
            }            
        }

        function controlToSlider(fromSlider, toSlider, toInput) {
            const [from, to] = getParsed(fromSlider, toSlider);
            fillSlider(fromSlider, toSlider , '#C6C6C6', '#25daa5', toSlider);
            setToggleAccessible(toSlider);
            if (from <= to) {
                toSlider.value = to;
                toInput.value = to;
            } else {
                toInput.value = from;
                toSlider.value = from;
            }
        }

        function getParsed(currentFrom, currentTo) {
            const from = parseInt(currentFrom.value, 10);
            app.SearchMin = from;
            const to = parseInt(currentTo.value, 10);
            app.SearchMax = to;
            return [from, to];
        }

        function setToggleAccessible(currentTarget) {
            const toSlider = document.querySelector('#ToSlider');
            if (Number(currentTarget.value) <= 0) {
                toSlider.style.zindex = 2;
            } else {
                toSlider.style.zindex = 0;
            }
        }



    </script>


    <!--AJAX-->
    <script>

        $.ajax({
            type: "get",
            url: "CityCountyData.json",
            success: function (e) {
                //console.log(e);
                for (let city in e) {
                    //console.log(e[city].CityName);
                    app.City.push(e[city].CityName);
                    app.AreaList.push(e[city].AreaList);
                    //for (let area in e[city].AreaList) {
                    //    console.log(e[city].AreaList[area].AreaName);
                    //}
                }
            }
        });

        $.ajax({
            type: "get",
            url: "/api/Color",
            success:  function (e) {
                //console.log(e);
                for (color in e) {
                    app.Colors.push(e[color]);
                    app.ColorStyle.push({ backgroundColor: e[color].colorCss });
                    //app.Displayheart[color].push(false);
                }
                //app.ColorStyle[12] = ({ background: 'linear-gradient(to right, #fffbd5, #b20a2c)' });
                app.ColorStyle[4] = ({ backgroundColor: "#F2F2F2", border: 'gray solid 1pt' });
                app.ColorStyle[12] = ({ backgroundImage: 'linear-gradient(to right, #ed6ea0 0%, #ec8c69 100%)' });
                app.ColorStyle[13] = ({ backgroundColor: "#FFFFFF", border: 'gray solid 1pt' });
                //app.ColorStyle[13] = ({ backgroundColor: "#00ffff", border: 'black solid 1pt' });
                //background - image: linear - gradient(to right, #b8cbb8 0 %, #b8cbb8 0 %, #b465da 0 %, #cf6cc9 33 %, #ee609c 66 %, #ee609c 100 %);
                //console.log(app.ColorStyle);
            }
        });

        $.ajax({
            type: "get",
            url: "/api/TagTable",
            success: function (e) {
                //console.log(e);
                for (let g = 0; g < 10; g++) {
                    app.Tag.push(e[g]);
                }
                //console.log(app.Tag);
            }
        });

        $.ajax({
            type: "get",
            url: "/api/PCodeTable",
            success: function (e) {
                console.log(e);
                app.CCode = e;
            }
        });

        $.ajax({
            type: "get",
            url: "/api/DemoSet/GetDemoSet",
            success: function (e) {
                //console.log(e);
                //app.CCode = e;
                app.DemoSet = e;
            }
        });

        $.ajax({
            type: "get",
            url: "/api/DemoSet/GetMaxPrice",
            success: function (e) {
                //console.log(e.max);
                app.MaxPrice = e.max;
            }
        });

        $.ajax({
            type: "get",
            url: "/api/DemoSet/GetMinPrice",
            success: function (e) {
                //console.log(e.max);
                app.MinPrice = e.min;
            }
        });





    </script>

    <!--On-->
    <script>
        async function ShowCountry(e) {
            app.Area=[];
            //console.log(app.AreaList);
             for (Area in app.AreaList[e.value]) {
                await app.Area.push(app.AreaList[e.value][Area].AreaName);
            }
            app.ShowAreas = true;
            console.log(app.City[e.value]);
            let AreaStr;
            AreaStr = app.City[e.value].replace("臺", "台");

            $.ajax({
                type: "get",
                url: "/api/DemoSet/GetCountyDemo/?Country=" + AreaStr ,
                success: function (e) {
                    console.log(e);
                    app.DemoSet = [];
                    for (demo in e) {
                        app.DemoSet.push(e[demo]);
                    }
                }
            });


        }

        function HoverColor(e) {
            app.Displayheart[e.value] = true;
        }

        function ShowArea(e) {
            console.log(e.value)
            $.ajax({
                type: "get",
                url: "/api/DemoSet/GetAreaDemo/?Area=" + e.value,
                success: function (e) {
                    console.log(e);
                    app.DemoSet = [];
                    for (demo in e) {
                        app.DemoSet.push(e[demo]);
                    }
                }
            });
        }

        function ShowColor(e) {
            console.log(e.value);
            $.ajax({
                type: "get",
                url: "/api/DemoSet/GetColorDemo/?Color=" + e.value,
                success: function (e) {
                    console.log(e);
                    app.DemoSet = [];
                    for (demo in e) {
                        app.DemoSet.push(e[demo]);
                    }
                }
            });
        }

        function ShowTag(e) {
            //console.log(e.value);
            $.ajax({
                type: "get",
                url: "/api/DemoSet/GetFixTagDemo/?FixTag=" + e.value,
                success: function (e) {
                    console.log(e);
                    app.DemoSet = [];
                    for (demo in e) {
                        app.DemoSet.push(e[demo]);
                    }
                }
            });
        }

        function SeachPrice() {
            //console.log("MIN"+app.SearchMin);
            //console.log(app.SearchMax);
            $.ajax({
                type: "get",
                url: "/api/DemoSet/GetPriceRange?Min=" + app.SearchMin + "&Max=" + app.SearchMax,
                success: function (e) {
                    console.log(e);
                    app.DemoSet = [];
                    for (demo in e) {
                        app.DemoSet.push(e[demo]);
                    }
                }
            });
        }

        function GetPriceMin(e) {
            //console.log("MIN"+app.SearchMin);
            //console.log(app.SearchMax);
            app.SearchMin = e;
            console.log(app.SearchMin);
            $.ajax({
                type: "get",
                url: "/api/DemoSet/GetPriceRange?Min=" + app.SearchMin + "&Max=" + app.SearchMax,
                success: function (e) {
                    console.log(e);
                    app.DemoSet = [];
                    for (demo in e) {
                        app.DemoSet.push(e[demo]);
                    }
                }
            });
        }

        function GetPriceMax(e) {
            //console.log("MIN"+app.SearchMin);
            //console.log(app.SearchMax);
            app.SearchMax = e;
            console.log(app.SearchMax);

            $.ajax({
                type: "get",
                url: "/api/DemoSet/GetPriceRange?Min=" + app.SearchMin + "&Max=" + app.SearchMax,
                success: function (e) {
                    console.log(e);
                    app.DemoSet = [];
                    for (demo in e) {
                        app.DemoSet.push(e[demo]);
                    }
                }
            });
        }

        function ShowPart(e) {
            //console.log(e.value);
            $.ajax({
                type: "get",
                url: "/api/DemoSet/GetPart/?Part=" + e.value,
                success: function (e) {
                    console.log(e);
                    app.DemoSet = [];
                    for (demo in e) {
                        app.DemoSet.push(e[demo]);
                    }
                }
            });
        }

        function ChangeQuery(e) {
            console.log(e.value);
            app.NowQuery = e.value;
        }

        function Searchit() {
            console.log(app.SearchString);
            $.ajax({
                type: "get",
                url: "/api/DemoSet/GetSearchAllTable?search=" + app.SearchString,
                success: function (e) {
                    app.DemoSet = [];
                    for (DS in e) {
                        app.DemoSet.push(e[DS]);
                    }
                }
            });
            console.log(app.DemoSet);
        }

        function SearchM() {
            console.log(app.SearchM);
            //$.ajax({
            //    type: "get",
            //    url: "/api/Manicurist?name=" + app.SearchM,
            //    success: function (e) {
            //        app.DemoSet = [];
            //        for (DS in e) {
            //            app.DemoSet.push(e[DS]);
            //        }
            //    }
            //});
        }



    </script>


</body>
</html>