<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>綠界訂單測試</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
        integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <!-- 套入bootstrap 和 JQ -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">

    <link rel="stylesheet" href="../css/product.css">
    <script src="../lib/jquery/dist/jquery.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>


</head>

<body>

    
    
    <!-- 綠界金流表單 -->
    <div class="cash">
        <input type="hidden" id="HashKey" value="pwFHCqoQZGmho4w6" />
        <input type="hidden" id="HashIV" value="EkRm7iFT261dpevs" />
        <form id="cashform" action="https://payment-stage.ecpay.com.tw/Cashier/AioCheckOut/V5" method="post">
            <input type="hidden" name="MerchantID" value="3002607">
            <br />
            <input type="text" name="MerchantTradeNo" value="DX20230127114112152C">
            <br />
            <input type="text" name="MerchantTradeDate" value="2023/01/27 11:41:12">
            <br />
            <input type="hidden" name="PaymentType" value="aio">
            <br />
            <input type="text" name="TotalAmount" value="1000">
            <br />
            <input type="text" name="TradeDesc" value="美甲">
            <br />
            <input type="text" name="ItemName" value="繽紛">
            <br />
            <input type="hidden" name="ReturnURL" value="https://hoyo.idv.tw/?a=Tools/EcPay&b=ReturnURL">
            <br />
            <input type="hidden" id="" name="ChoosePayment" value="Credit">
            <br />
            <input type="hidden" id="" name="CheckMacValue" value="">
            <br />
            <input type="hidden" id="" name="EncryptType" value="1">
            <br />
            <button type="button" id="btnCashSend">送出</button>

        </form>
    </div>

    <script>
        $('#btnCashSend').on('click', function () {

            // 寫死不用動
            // input MerchantID
            let HashKey = "HashKey=pwFHCqoQZGmho4w6"
            let HashIV = "EkRm7iFT261dpevs"

            // MerchantTradeNo 訂單編號
            // MerchantTradeDate 訂單日期
            // TotalAmount 付款金額
            // TradeDesc 商品描述
            // ItemName 商品名稱
            // 上面五個須給值
            let itemName = $('input[name="ItemName"]').val();
            let MerchantTradeDate = $('input[name="MerchantTradeDate"]').val();
            let MerchantTradeNo = $('input[name="MerchantTradeNo"]').val();


            let returnUrl = $('input[name="ReturnURL"]').val();

            // let OrderResultURL = $('input[name="OrderResultURL"]').val();

            let TotalAmount = $('input[name="TotalAmount"]').val();
            let TradeDesc = $('input[name="TradeDesc"]').val();

            // CheckMacValue 檢查碼生成 上面參數都正確會傳放入 val()進去
            let x = `${HashKey}&ChoosePayment=Credit&EncryptType=1&ItemName=${itemName}&MerchantID=3002607&MerchantTradeDate=${MerchantTradeDate}&MerchantTradeNo=${MerchantTradeNo}&PaymentType=aio&ReturnURL=${returnUrl}&TotalAmount=${TotalAmount}&TradeDesc=${TradeDesc}&HashIV=${HashIV}`

            let y = encodeURIComponent(x)
            y = y.replace("%20", "+")
            y = y.toLowerCase();

            var hash = CryptoJS.SHA256(y).toString();

            hash = hash.toUpperCase()
            $('input[name="CheckMacValue"]').val(hash)

            $('#cashform').submit();
        })

        // let z = "HashKey%3dpwFHCqoQZGmho4w6%26ChoosePayment%3dCredit%26EncryptType%3d1%26ItemName%3d%e7%b9%bd%e7%b4%9b%26MerchantID%3d3002607%26MerchantTradeDate%3d2023%2f01%2f27+11%3a41%3a12%26MerchantTradeNo%3dDX20230127114112152a%26PaymentType%3daio%26ReturnURL%3dhttps%3a%2f%2fhoyo.idv.tw%2f%3fa%3dTools%2fEcPay%26b%3dReturnURL%26TotalAmount%3d1000%26TradeDesc%3d%e7%be%8e%e7%94%b2%26HashIV%3dEkRm7iFT261dpevs";
        // %20 應該轉換成 +

    </script>
</body>

</html>